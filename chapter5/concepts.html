<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Concepts - High Performance Programming</title>
        <!-- Custom HTML head -->
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="Monash DeepNeuron&#x27;s High Performance Programming Curriculum">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">
        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">
        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <!-- MathJax -->
        <script async type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../home.html">Home</a></li><li class="chapter-item expanded affix "><div>Foreword</div></li><li class="chapter-item expanded "><a href="../chapter1/chapter1.html"><strong aria-hidden="true">1.</strong> Getting Started</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chapter1/wsl.html"><strong aria-hidden="true">1.1.</strong> WSL</a></li><li class="chapter-item expanded "><a href="../chapter1/software.html"><strong aria-hidden="true">1.2.</strong> Installing Software</a></li><li class="chapter-item expanded "><a href="../chapter1/helloworld.html"><strong aria-hidden="true">1.3.</strong> Hello World</a></li><li class="chapter-item expanded "><a href="../chapter1/godbolt.html"><strong aria-hidden="true">1.4.</strong> Compiler Explorer</a></li><li class="chapter-item expanded "><a href="../chapter1/slides1.html"><strong aria-hidden="true">1.5.</strong> Slides</a></li></ol></li><li class="chapter-item expanded "><a href="../chapter2/chapter2.html"><strong aria-hidden="true">2.</strong> Basics of C++</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chapter2/typesystem.html"><strong aria-hidden="true">2.1.</strong> The C++ Type System</a></li><li class="chapter-item expanded "><a href="../chapter2/types.html"><strong aria-hidden="true">2.2.</strong> Primitive Types</a></li><li class="chapter-item expanded "><a href="../chapter2/variables.html"><strong aria-hidden="true">2.3.</strong> Variables</a></li><li class="chapter-item expanded "><a href="../chapter2/operators.html"><strong aria-hidden="true">2.4.</strong> Operators</a></li><li class="chapter-item expanded "><a href="../chapter2/io.html"><strong aria-hidden="true">2.5.</strong> IO</a></li><li class="chapter-item expanded "><a href="../chapter2/eqordlogic.html"><strong aria-hidden="true">2.6.</strong> Equality, Ordering &amp; Logical Operators</a></li><li class="chapter-item expanded "><a href="../chapter2/condexpr.html"><strong aria-hidden="true">2.7.</strong> Conditional Expressions</a></li><li class="chapter-item expanded "><a href="../chapter2/loops.html"><strong aria-hidden="true">2.8.</strong> Loops</a></li><li class="chapter-item expanded "><a href="../chapter2/functions.html"><strong aria-hidden="true">2.9.</strong> Functions</a></li><li class="chapter-item expanded "><a href="../chapter2/slides2.html"><strong aria-hidden="true">2.10.</strong> Slides</a></li></ol></li><li class="chapter-item expanded "><a href="../chapter3/chapter3.html"><strong aria-hidden="true">3.</strong> Memory</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chapter3/pointers.html"><strong aria-hidden="true">3.1.</strong> Pointers</a></li><li class="chapter-item expanded "><a href="../chapter3/slices.html"><strong aria-hidden="true">3.2.</strong> Slices</a></li><li class="chapter-item expanded "><a href="../chapter3/references.html"><strong aria-hidden="true">3.3.</strong> References</a></li><li class="chapter-item expanded "><a href="../chapter3/memory.html"><strong aria-hidden="true">3.4.</strong> Dynamic Memory</a></li><li class="chapter-item expanded "><a href="../chapter3/stdlib.html"><strong aria-hidden="true">3.5.</strong> The Standard Library</a></li><li class="chapter-item expanded "><a href="../chapter3/slides3.html"><strong aria-hidden="true">3.6.</strong> Slides</a></li></ol></li><li class="chapter-item expanded "><a href="../chapter4/chapter4.html"><strong aria-hidden="true">4.</strong> Intermediate C++ Features</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chapter4/advfunc.html"><strong aria-hidden="true">4.1.</strong> Advanced Function Concepts</a></li><li class="chapter-item expanded "><a href="../chapter4/namespaces.html"><strong aria-hidden="true">4.2.</strong> Namespaces</a></li><li class="chapter-item expanded "><a href="../chapter4/enums.html"><strong aria-hidden="true">4.3.</strong> Enumerations</a></li><li class="chapter-item expanded "><a href="../chapter4/unions.html"><strong aria-hidden="true">4.4.</strong> Unions</a></li><li class="chapter-item expanded "><a href="../chapter4/structs.html"><strong aria-hidden="true">4.5.</strong> Structures</a></li><li class="chapter-item expanded "><a href="../chapter4/task1.html"><strong aria-hidden="true">4.6.</strong> Task 1</a></li><li class="chapter-item expanded "><a href="../chapter4/slides4.html"><strong aria-hidden="true">4.7.</strong> Slides</a></li></ol></li><li class="chapter-item expanded "><a href="../chapter5/chapter5.html"><strong aria-hidden="true">5.</strong> Generic Programming</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chapter5/classes.html"><strong aria-hidden="true">5.1.</strong> Classes</a></li><li class="chapter-item expanded "><a href="../chapter5/templates.html"><strong aria-hidden="true">5.2.</strong> Templates</a></li><li class="chapter-item expanded "><a href="../chapter5/generics.html"><strong aria-hidden="true">5.3.</strong> Generics</a></li><li class="chapter-item expanded "><a href="../chapter5/concepts.html" class="active"><strong aria-hidden="true">5.4.</strong> Concepts</a></li><li class="chapter-item expanded "><a href="../chapter5/task2.html"><strong aria-hidden="true">5.5.</strong> Task 2</a></li><li class="chapter-item expanded "><a href="../chapter5/slides5.html"><strong aria-hidden="true">5.6.</strong> Slides</a></li></ol></li><li class="chapter-item expanded "><a href="../chapter6/chapter6.html"><strong aria-hidden="true">6.</strong> Algorithms &amp; Data Structures</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chapter6/iterators.html"><strong aria-hidden="true">6.1.</strong> Iterators</a></li><li class="chapter-item expanded "><a href="../chapter6/data-structures.html"><strong aria-hidden="true">6.2.</strong> Data Structures</a></li><li class="chapter-item expanded "><a href="../chapter6/algorithms.html"><strong aria-hidden="true">6.3.</strong> Algorithms</a></li><li class="chapter-item expanded "><a href="../chapter6/ranges.html"><strong aria-hidden="true">6.4.</strong> Ranges</a></li><li class="chapter-item expanded "><a href="../chapter6/views.html"><strong aria-hidden="true">6.5.</strong> Views</a></li><li class="chapter-item expanded "><a href="../chapter6/task3.html"><strong aria-hidden="true">6.6.</strong> Task 3</a></li><li class="chapter-item expanded "><a href="../chapter6/slides6.html"><strong aria-hidden="true">6.7.</strong> Slides</a></li></ol></li><li class="chapter-item expanded "><a href="../chapter7/chapter7.html"><strong aria-hidden="true">7.</strong> Concurrent Computing</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../chapter7/parallel-alg.html"><strong aria-hidden="true">7.1.</strong> Parallel Algorithms</a></li><li class="chapter-item expanded "><a href="../chapter7/atomics.html"><strong aria-hidden="true">7.2.</strong> Atomics</a></li><li class="chapter-item expanded "><a href="../chapter7/threads.html"><strong aria-hidden="true">7.3.</strong> Threads</a></li><li class="chapter-item expanded "><a href="../chapter7/mutexes.html"><strong aria-hidden="true">7.4.</strong> Mutexes</a></li><li class="chapter-item expanded "><a href="../chapter7/async.html"><strong aria-hidden="true">7.5.</strong> Asynchronous Programming</a></li><li class="chapter-item expanded "><a href="../chapter7/slides7.html"><strong aria-hidden="true">7.6.</strong> Slides</a></li></ol></li><li class="chapter-item expanded "><a href="../GODBOLT.html">Godbolt Examples</a></li><li class="chapter-item expanded affix "><a href="../planned.html">Planned Additions</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">High Performance Programming</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/MonashDeepNeuron/HPP" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="concepts"><a class="header" href="#concepts">Concepts</a></h1>
<h2 id="limitations-to-templates"><a class="header" href="#limitations-to-templates">Limitations to templates</a></h2>
<p>Templates are extremely powerful allow us to create reusable and extendible code however there is a caveat to this. Take for example our <code>Point</code> class from Sections 1-2. <code>Point</code> just takes a single type <code>T</code>. This can be absolutely any type. This can become a problem though later for the user. Say we have a <code>Point&lt;std::string&gt;</code>. This will cause an error for the user of our <code>Point</code> class if they try to take two <code>Point&lt;std::string&gt;</code> because <code>-</code> is not supported by <code>std::string</code>. This can be a major problem as the error produced can be ambiguous to the user and require looking at the source code in depth to diagnose.</p>
<pre><code class="language-cxx">/// ... Point implementation

using namespace std::literals;

auto main() -&gt; int
{
   auto p1 = Point{ &quot;Hello&quot;s, &quot;Hi&quot;s };
   auto p2 = Point{ &quot;Goobye&quot;s, &quot;Bye&quot;s };

   auto p3 = p1 - p2;

   std::cout &lt;&lt; p3 &lt;&lt; std::endl;

    return 0;
}
</code></pre>
<p>The error output (by GCC). As we can see it is verbose and delves into many of the attempts to make it work, and this is for a simple class.</p>
<pre><code class="language-sh">&lt;source&gt;: In instantiation of 'constexpr Point&lt;typename std::common_type&lt;T, U&gt;::type&gt; Point&lt;T&gt;::operator-(const Point&lt;U&gt;&amp;) [with U = std::__cxx11::basic_string&lt;char&gt;; T = std::__cxx11::basic_string&lt;char&gt;; typename std::common_type&lt;T, U&gt;::type = std::__cxx11::basic_string&lt;char&gt;]':
&lt;source&gt;:96:19:   required from here
&lt;source&gt;:61:62: error: no match for 'operator-' (operand types are 'std::__cxx11::basic_string&lt;char&gt;' and 'const std::__cxx11::basic_string&lt;char&gt;')
   61 |     { return Point&lt;typename std::common_type&lt;T, U&gt;::type&gt;{ x - p.x, y - p.y }; }
      |                                                            ~~^~~~~
In file included from /opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/string:47,
                 from /opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/bits/locale_classes.h:40,
                 from /opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/bits/ios_base.h:41,
                 from /opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/ios:42,
                 from /opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/ostream:38,
                 from /opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/iostream:39,
                 from &lt;source&gt;:1:
/opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/bits/stl_iterator.h:621:5: note: candidate: 'template&lt;class _IteratorL, class _IteratorR&gt; constexpr decltype ((__y.base() - __x.base())) std::operator-(const reverse_iterator&lt;_IteratorL&gt;&amp;, const reverse_iterator&lt;_IteratorR&gt;&amp;)'
  621 |     operator-(const reverse_iterator&lt;_IteratorL&gt;&amp; __x,
      |     ^~~~~~~~
/opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/bits/stl_iterator.h:621:5: note:   template argument deduction/substitution failed:
&lt;source&gt;:61:62: note:   'std::__cxx11::basic_string&lt;char&gt;' is not derived from 'const std::reverse_iterator&lt;_IteratorL&gt;'
   61 |     { return Point&lt;typename std::common_type&lt;T, U&gt;::type&gt;{ x - p.x, y - p.y }; }
      |                                                            ~~^~~~~
/opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/bits/stl_iterator.h:1778:5: note: candidate: 'template&lt;class _IteratorL, class _IteratorR&gt; constexpr decltype ((__x.base() - __y.base())) std::operator-(const move_iterator&lt;_IteratorL&gt;&amp;, const move_iterator&lt;_IteratorR&gt;&amp;)'
 1778 |     operator-(const move_iterator&lt;_IteratorL&gt;&amp; __x,
      |     ^~~~~~~~
/opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/bits/stl_iterator.h:1778:5: note:   template argument deduction/substitution failed:
&lt;source&gt;:61:62: note:   'std::__cxx11::basic_string&lt;char&gt;' is not derived from 'const std::move_iterator&lt;_IteratorL&gt;'
   61 |     { return Point&lt;typename std::common_type&lt;T, U&gt;::type&gt;{ x - p.x, y - p.y }; }
      |                                                            ~~^~~~~
&lt;source&gt;:61:71: error: no match for 'operator-' (operand types are 'std::__cxx11::basic_string&lt;char&gt;' and 'const std::__cxx11::basic_string&lt;char&gt;')
   61 |     { return Point&lt;typename std::common_type&lt;T, U&gt;::type&gt;{ x - p.x, y - p.y }; }
      |                                                                     ~~^~~~~
/opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/bits/stl_iterator.h:621:5: note: candidate: 'template&lt;class _IteratorL, class _IteratorR&gt; constexpr decltype ((__y.base() - __x.base())) std::operator-(const reverse_iterator&lt;_IteratorL&gt;&amp;, const reverse_iterator&lt;_IteratorR&gt;&amp;)'
  621 |     operator-(const reverse_iterator&lt;_IteratorL&gt;&amp; __x,
      |     ^~~~~~~~
/opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/bits/stl_iterator.h:621:5: note:   template argument deduction/substitution failed:
&lt;source&gt;:61:71: note:   'std::__cxx11::basic_string&lt;char&gt;' is not derived from 'const std::reverse_iterator&lt;_IteratorL&gt;'
   61 |     { return Point&lt;typename std::common_type&lt;T, U&gt;::type&gt;{ x - p.x, y - p.y }; }
      |                                                                     ~~^~~~~
/opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/bits/stl_iterator.h:1778:5: note: candidate: 'template&lt;class _IteratorL, class _IteratorR&gt; constexpr decltype ((__x.base() - __y.base())) std::operator-(const move_iterator&lt;_IteratorL&gt;&amp;, const move_iterator&lt;_IteratorR&gt;&amp;)'
 1778 |     operator-(const move_iterator&lt;_IteratorL&gt;&amp; __x,
      |     ^~~~~~~~
/opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/bits/stl_iterator.h:1778:5: note:   template argument deduction/substitution failed:
&lt;source&gt;:61:71: note:   'std::__cxx11::basic_string&lt;char&gt;' is not derived from 'const std::move_iterator&lt;_IteratorL&gt;'
   61 |     { return Point&lt;typename std::common_type&lt;T, U&gt;::type&gt;{ x - p.x, y - p.y }; }
      |                                                                     ~~^~~~~
&lt;source&gt;:61:77: error: no matching function for call to 'Point&lt;std::__cxx11::basic_string&lt;char&gt; &gt;::Point(&lt;brace-enclosed initializer list&gt;)'
   61 |     { return Point&lt;typename std::common_type&lt;T, U&gt;::type&gt;{ x - p.x, y - p.y }; }
      |                                                                             ^
&lt;source&gt;:20:15: note: candidate: 'constexpr Point&lt;T&gt;::Point(Point&lt;T&gt;&amp;&amp;) [with T = std::__cxx11::basic_string&lt;char&gt;]'
   20 |     constexpr Point(Point&amp;&amp; p) noexcept
      |               ^~~~~
&lt;source&gt;:20:15: note:   candidate expects 1 argument, 2 provided
&lt;source&gt;:16:15: note: candidate: 'constexpr Point&lt;T&gt;::Point(const Point&lt;T&gt;&amp;) [with T = std::__cxx11::basic_string&lt;char&gt;]'
   16 |     constexpr Point(const Point&amp; p) noexcept
      |               ^~~~~
&lt;source&gt;:16:15: note:   candidate expects 1 argument, 2 provided
&lt;source&gt;:12:5: note: candidate: 'constexpr Point&lt;T&gt;::Point(T, T) [with T = std::__cxx11::basic_string&lt;char&gt;]'
   12 |     Point(T x, T y) noexcept
      |     ^~~~~
&lt;source&gt;:12:5: note:   conversion of argument 1 would be ill-formed:
&lt;source&gt;:9:15: note: candidate: 'constexpr Point&lt;T&gt;::Point() [with T = std::__cxx11::basic_string&lt;char&gt;]'
    9 |     constexpr Point() = default;
      |               ^~~~~
&lt;source&gt;:9:15: note:   candidate expects 0 arguments, 2 provided
ASM generation compiler returned: 1
&lt;source&gt;: In instantiation of 'constexpr Point&lt;typename std::common_type&lt;T, U&gt;::type&gt; Point&lt;T&gt;::operator-(const Point&lt;U&gt;&amp;) [with U = std::__cxx11::basic_string&lt;char&gt;; T = std::__cxx11::basic_string&lt;char&gt;; typename std::common_type&lt;T, U&gt;::type = std::__cxx11::basic_string&lt;char&gt;]':
&lt;source&gt;:96:19:   required from here
&lt;source&gt;:61:62: error: no match for 'operator-' (operand types are 'std::__cxx11::basic_string&lt;char&gt;' and 'const std::__cxx11::basic_string&lt;char&gt;')
   61 |     { return Point&lt;typename std::common_type&lt;T, U&gt;::type&gt;{ x - p.x, y - p.y }; }
      |                                                            ~~^~~~~
In file included from /opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/string:47,
                 from /opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/bits/locale_classes.h:40,
                 from /opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/bits/ios_base.h:41,
                 from /opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/ios:42,
                 from /opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/ostream:38,
                 from /opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/iostream:39,
                 from &lt;source&gt;:1:
/opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/bits/stl_iterator.h:621:5: note: candidate: 'template&lt;class _IteratorL, class _IteratorR&gt; constexpr decltype ((__y.base() - __x.base())) std::operator-(const reverse_iterator&lt;_IteratorL&gt;&amp;, const reverse_iterator&lt;_IteratorR&gt;&amp;)'
  621 |     operator-(const reverse_iterator&lt;_IteratorL&gt;&amp; __x,
      |     ^~~~~~~~
/opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/bits/stl_iterator.h:621:5: note:   template argument deduction/substitution failed:
&lt;source&gt;:61:62: note:   'std::__cxx11::basic_string&lt;char&gt;' is not derived from 'const std::reverse_iterator&lt;_IteratorL&gt;'
   61 |     { return Point&lt;typename std::common_type&lt;T, U&gt;::type&gt;{ x - p.x, y - p.y }; }
      |                                                            ~~^~~~~
/opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/bits/stl_iterator.h:1778:5: note: candidate: 'template&lt;class _IteratorL, class _IteratorR&gt; constexpr decltype ((__x.base() - __y.base())) std::operator-(const move_iterator&lt;_IteratorL&gt;&amp;, const move_iterator&lt;_IteratorR&gt;&amp;)'
 1778 |     operator-(const move_iterator&lt;_IteratorL&gt;&amp; __x,
      |     ^~~~~~~~
/opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/bits/stl_iterator.h:1778:5: note:   template argument deduction/substitution failed:
&lt;source&gt;:61:62: note:   'std::__cxx11::basic_string&lt;char&gt;' is not derived from 'const std::move_iterator&lt;_IteratorL&gt;'
   61 |     { return Point&lt;typename std::common_type&lt;T, U&gt;::type&gt;{ x - p.x, y - p.y }; }
      |                                                            ~~^~~~~
&lt;source&gt;:61:71: error: no match for 'operator-' (operand types are 'std::__cxx11::basic_string&lt;char&gt;' and 'const std::__cxx11::basic_string&lt;char&gt;')
   61 |     { return Point&lt;typename std::common_type&lt;T, U&gt;::type&gt;{ x - p.x, y - p.y }; }
      |                                                                     ~~^~~~~
/opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/bits/stl_iterator.h:621:5: note: candidate: 'template&lt;class _IteratorL, class _IteratorR&gt; constexpr decltype ((__y.base() - __x.base())) std::operator-(const reverse_iterator&lt;_IteratorL&gt;&amp;, const reverse_iterator&lt;_IteratorR&gt;&amp;)'
  621 |     operator-(const reverse_iterator&lt;_IteratorL&gt;&amp; __x,
      |     ^~~~~~~~
/opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/bits/stl_iterator.h:621:5: note:   template argument deduction/substitution failed:
&lt;source&gt;:61:71: note:   'std::__cxx11::basic_string&lt;char&gt;' is not derived from 'const std::reverse_iterator&lt;_IteratorL&gt;'
   61 |     { return Point&lt;typename std::common_type&lt;T, U&gt;::type&gt;{ x - p.x, y - p.y }; }
      |                                                                     ~~^~~~~
/opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/bits/stl_iterator.h:1778:5: note: candidate: 'template&lt;class _IteratorL, class _IteratorR&gt; constexpr decltype ((__x.base() - __y.base())) std::operator-(const move_iterator&lt;_IteratorL&gt;&amp;, const move_iterator&lt;_IteratorR&gt;&amp;)'
 1778 |     operator-(const move_iterator&lt;_IteratorL&gt;&amp; __x,
      |     ^~~~~~~~
/opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/bits/stl_iterator.h:1778:5: note:   template argument deduction/substitution failed:
&lt;source&gt;:61:71: note:   'std::__cxx11::basic_string&lt;char&gt;' is not derived from 'const std::move_iterator&lt;_IteratorL&gt;'
   61 |     { return Point&lt;typename std::common_type&lt;T, U&gt;::type&gt;{ x - p.x, y - p.y }; }
      |                                                                     ~~^~~~~
&lt;source&gt;:61:77: error: no matching function for call to 'Point&lt;std::__cxx11::basic_string&lt;char&gt; &gt;::Point(&lt;brace-enclosed initializer list&gt;)'
   61 |     { return Point&lt;typename std::common_type&lt;T, U&gt;::type&gt;{ x - p.x, y - p.y }; }
      |                                                                             ^
&lt;source&gt;:20:15: note: candidate: 'constexpr Point&lt;T&gt;::Point(Point&lt;T&gt;&amp;&amp;) [with T = std::__cxx11::basic_string&lt;char&gt;]'
   20 |     constexpr Point(Point&amp;&amp; p) noexcept
      |               ^~~~~
&lt;source&gt;:20:15: note:   candidate expects 1 argument, 2 provided
&lt;source&gt;:16:15: note: candidate: 'constexpr Point&lt;T&gt;::Point(const Point&lt;T&gt;&amp;) [with T = std::__cxx11::basic_string&lt;char&gt;]'
   16 |     constexpr Point(const Point&amp; p) noexcept
      |               ^~~~~
&lt;source&gt;:16:15: note:   candidate expects 1 argument, 2 provided
&lt;source&gt;:12:5: note: candidate: 'constexpr Point&lt;T&gt;::Point(T, T) [with T = std::__cxx11::basic_string&lt;char&gt;]'
   12 |     Point(T x, T y) noexcept
      |     ^~~~~
&lt;source&gt;:12:5: note:   conversion of argument 1 would be ill-formed:
&lt;source&gt;:9:15: note: candidate: 'constexpr Point&lt;T&gt;::Point() [with T = std::__cxx11::basic_string&lt;char&gt;]'
    9 |     constexpr Point() = default;
      |               ^~~~~
&lt;source&gt;:9:15: note:   candidate expects 0 arguments, 2 provided
Execution build compiler returned: 1
</code></pre>
<p><a href="https://www.godbolt.org/z/P9b3EMGdY">Example</a></p>
<p>To address this C++20 introduced concepts. A mechanism for imposing constraints on types.</p>
<h2 id="what-is-a-concept"><a class="header" href="#what-is-a-concept">What is a Concept?</a></h2>
<p>A concepts is a set of conditions and requirements imposed on a type that is checked at compile time and evaluates as a Boolean. Before C++20, template metaprogramming and SFINAE where used to statically impose constraints on types but they had limitations and were highly verbose. Concepts allow us to define syntactic constraints on a template type and then impose those constraints on other types. Concepts are introduced using a template declaration followed by a concept declaration (similar to a class declaration but replace the keyword <code>class</code> with <code>concept</code>). Concepts can be composed of other concepts using <code>||</code> and <code>&amp;&amp;</code> (holding similar semantics to there Boolean equivalents). It is difficult to create meaningful concepts as one, they are very new to both C++ but also programming in general, instead try and use the concepts defined by the standard library; from the <code>&lt;concepts&gt;</code> header, first and impose them on a case by case basis using the techniques we are going to learn below.</p>
<pre><code class="language-cxx">#include &lt;concepts&gt;
#include &lt;iomanip&gt;
#include &lt;iostream&gt;
#include &lt;string&gt;
#include &lt;utility&gt;

/// Concept defining a type that can be hashed using `std::hash`
template&lt;typename H&gt;
concept Hashable = requires (H a)
{
    { std::hash&lt;H&gt;{}(a) } -&gt; std::convertible_to&lt;std::size_t&gt;;
};

struct NotHashable {};

using namespace std::literals;

auto main() -&gt; int
{
   std::cout &lt;&lt; std::boolalpha;
   std::cout &lt;&lt; &quot;Is Hashable&lt;int&gt;:          &quot; &lt;&lt; Hashable&lt;int&gt; &lt;&lt; &quot;  : std::hash&lt;int&gt;{}(69)               = &quot; &lt;&lt; std::hash&lt;int&gt;{}(69) &lt;&lt; std::endl;
   std::cout &lt;&lt; &quot;Is Hashable&lt;float&gt;:        &quot; &lt;&lt; Hashable&lt;float&gt; &lt;&lt; &quot;  : std::hash&lt;float&gt;{}(4.5756f)        = &quot; &lt;&lt; std::hash&lt;float&gt;{}(4.5756f) &lt;&lt; std::endl;
   std::cout &lt;&lt; &quot;Is Hashable&lt;double&gt;:       &quot; &lt;&lt; Hashable&lt;double&gt; &lt;&lt; &quot;  : std::hash&lt;double&gt;{}(-0.0036565764) = &quot; &lt;&lt; std::hash&lt;double&gt;{}(-0.0036565764) &lt;&lt; std::endl;
   std::cout &lt;&lt; &quot;Is Hashable&lt;std::string&gt;:  &quot; &lt;&lt; Hashable&lt;std::string&gt; &lt;&lt; &quot;  : std::hash&lt;std::string&gt;{}()         = &quot; &lt;&lt; std::hash&lt;std::string&gt;{}(&quot;&quot;s) &lt;&lt; std::endl;
   std::cout &lt;&lt; &quot;Is Hashable&lt;NotHashable&gt;:  &quot; &lt;&lt; Hashable&lt;NotHashable&gt; &lt;&lt; std::endl;

    return 0;
}
</code></pre>
<p><a href="https://www.godbolt.org/z/Px75v8ssf">Example</a></p>
<ul>
<li><a href="https://en.cppreference.com/w/cpp/concepts"><code>&lt;concepts&gt;</code></a></li>
<li><a href="https://en.cppreference.com/w/cpp/language/constraints">Constraints and concepts</a></li>
</ul>
<h2 id="constrained-templates"><a class="header" href="#constrained-templates">Constrained templates</a></h2>
<p>Concepts are easiest to use when constraining templates type parameters. Instead of the using the keyword <code>typename</code> when can instead use a concept. This will impose the rules on the template type at the point of instantiation. We can see this best with our <code>Point</code> class. Being that a 'point' is a numerical value in a field; say coordinates on a cartesian plane we might want to restrict the type parameter <code>T</code> of <code>Point</code> to a number type. C++'s concepts library already has a concept for this called <code>std::integral</code>. Lets impose this new template type parameter constraint on <code>T</code>.</p>
<pre><code class="language-cxx">template&lt;std::integral T&gt;
class Point
{
    /// ... implementation
};

using namespace std::literals;

auto main() -&gt; int
{
   auto p1 = Point{ &quot;Hello&quot;s, &quot;Hi&quot;s };

    return 0;
}
</code></pre>
<p>While C++ error messages aren't the most readable as the compiler tries many different things, amongst the errors is one stating 'template constraint failed ...'. This indicates to use that <code>std::string</code> is not an appropriate type for <code>Point</code> without needed to try and subtract two <code>Point&lt;std::string&gt;</code> or any other operation on it. The instantiation failed at construction.</p>
<pre><code class="language-sh"># ... other error info

&lt;source&gt;: In substitution of 'template&lt;class T&gt; Point(T, T)-&gt; Point&lt;T&gt; [with T = std::__cxx11::basic_string&lt;char&gt;]':
&lt;source&gt;:94:37:   required from here
&lt;source&gt;:13:5: error: template constraint failure for 'template&lt;class T&gt;  requires  integral&lt;T&gt; class Point'
&lt;source&gt;:13:5: note: constraints not satisfied
In file included from &lt;source&gt;:1:
/opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/concepts: In substitution of 'template&lt;class T&gt;  requires  integral&lt;T&gt; class Point [with T = std::__cxx11::basic_string&lt;char&gt;]':
&lt;source&gt;:13:5:   required by substitution of 'template&lt;class T&gt; Point(T, T)-&gt; Point&lt;T&gt; [with T = std::__cxx11::basic_string&lt;char&gt;]'
&lt;source&gt;:94:37:   required from here
/opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/concepts:100:13:   required for the satisfaction of 'integral&lt;T&gt;' [with T = std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;]
/opt/compiler-explorer/gcc-12.2.0/include/c++/12.2.0/concepts:100:24: note: the expression 'is_integral_v&lt;_Tp&gt; [with _Tp = std::__cxx11::basic_string&lt;char, std::char_traits&lt;char&gt;, std::allocator&lt;char&gt; &gt;]' evaluated to 'false'
  100 |     concept integral = is_integral_v&lt;_Tp&gt;;

# ... Other error info
</code></pre>
<p><a href="https://www.godbolt.org/z/1f1x8MTer">Example</a></p>
<p><a href="https://en.cppreference.com/w/cpp/concepts/integral"><code>std::integral</code></a></p>
<h2 id="requires-expressions"><a class="header" href="#requires-expressions">Requires expressions</a></h2>
<p>The is a slight problem with our reformed <code>Point</code> class. It no longer can accept floating point types as they are not considered integrals in C++. Instead we need to constraint <code>Point</code> to a type <code>T</code> by creating a conjunction (<code>&amp;&amp;</code>) or disjunction (<code>||</code>) of multiple concepts. To do this we use a requires clause. Requires clause are introduced just after (often syntactically below) a template declaration and consist of a list of requirements in the form of a Boolean concept expression. We can create a disjunction of the <code>std::integral</code> and <code>std::floating_point</code> allowing floating point types and integral types to be valid <code>T</code> for <code>Point</code>.</p>
<pre><code class="language-cxx">template&lt;typename T&gt;
    requires std::integral&lt;T&gt; || std::floating_point&lt;T&gt;
class Point
{
    /// ... implementation
};

auto main() -&gt; int
{
   auto p1 = Point{ 0.567, 45.657 };
   auto p2 = Point{ 1, 9 };

   std::cout &lt;&lt; p1 + p2 &lt;&lt; std::endl;
   std::cout &lt;&lt; p1 - p2 &lt;&lt; std::endl;

    return 0;
}
</code></pre>
<blockquote>
<p>Note: We could specify a more desirable constraint using the <code>std::is_arithmetic_v</code> type trait as a concept combines the two ideas better semantically but fine tuning <code>Point</code> can be an exercise for you.</p>
</blockquote>
<p><a href="https://www.godbolt.org/z/55dhT6W6j">Example</a></p>
<ul>
<li><a href="https://en.cppreference.com/w/cpp/concepts/floating_point"><code>std::floating_point</code></a></li>
<li><a href="https://en.cppreference.com/w/cpp/language/constraints#:%7E:text=on%20constraint%20normalization.-,Requires%20clauses,-The%20keyword"><code>requires</code> clause</a></li>
</ul>
<h3 id="requires-expression"><a class="header" href="#requires-expression">Requires expression</a></h3>
<p>Sometimes more complicated requirements need to be specified in order to fine the allowed behaviour of the program. Require expressions allow for mock values of template types to bne created and specify patterns that a value of the type parameter must provide. In the case of our <code>Point</code> class, we may want to also allow other types that support <code>+</code> and <code>-</code> binary operator overloads. Because this check depends on the type parameter of another <code>Point</code> we can't declare it at the requires clause at the template declaration of <code>Point</code>. Instead we need to create a requires clause at the operator overloads template declaration. We then declare our requires expression, enforcing the semantic and syntactic rules on the type. We can declare as many of these rules in a requires expression as we like. For <code>Point</code> we will ensure that for a value of type <code>T</code> called <code>a</code> and for a value of type <code>U</code> of name <code>b</code>, <code>a + b</code> and <code>a - b</code> is valid.</p>
<pre><code class="language-cxx">/// ... Point details

template&lt;typename U&gt;
    requires requires (T a, U b)
    {
        a + b;
    }
constexpr auto
operator+ (const Point&lt;U&gt;&amp; p) 
    noexcept -&gt; Point&lt;typename std::common_type&lt;T, U&gt;::type&gt;
{ return Point&lt;typename std::common_type&lt;T, U&gt;::type&gt;{ x + p.x, y + p.y }; }

template&lt;typename U&gt;
    requires requires (T a, U b)
    {
        a - b;
    }
constexpr auto
operator- (const Point&lt;U&gt;&amp; p) 
    noexcept -&gt; Point&lt;typename std::common_type&lt;T, U&gt;::type&gt;
{ return Point&lt;typename std::common_type&lt;T, U&gt;::type&gt;{ x - p.x, y - p.y }; }

/// ... Point details
</code></pre>
<blockquote>
<p>Note: The double <code>requires requires</code> notation is called an ad-hoc constraint. The first <code>requires</code> introduces a requires clause which can have concepts, conjunctions, disjunctions or requires expressions. The second <code>require</code> introduces a requires expression which takes a similar syntactic form to functions.</p>
</blockquote>
<p><a href="https://www.godbolt.org/z/763Y6fjjc">Example</a></p>
<p><a href="https://en.cppreference.com/w/cpp/language/requires"><code>requires</code> expression</a></p>
<h3 id="compound-requirements"><a class="header" href="#compound-requirements">Compound requirements</a></h3>
<p>We can also apply constraints on the expressions within a requires expression, ensuring the types or properties these expressions will have. These are called compound expressions, which we create by wrapping our individual rules from a requires expression in braces and use a <code>-&gt;</code> followed by a constraint on the return type of the expression.</p>
<pre><code class="language-cxx">/// ... Point details

template&lt;typename U&gt;
    requires requires (T a, U b)
    {
        { a + b } -&gt; std::same_as&lt;typename std::common_type&lt;T, U&gt;::type&gt;;
    }
constexpr auto
operator+ (const Point&lt;U&gt;&amp; p) 
    noexcept -&gt; Point&lt;typename std::common_type&lt;T, U&gt;::type&gt;
{ return Point&lt;typename std::common_type&lt;T, U&gt;::type&gt;{ x + p.x, y + p.y }; }

template&lt;typename U&gt;
    requires requires (T a, U b)
    {
        { a - b } -&gt; std::same_as&lt;typename std::common_type&lt;T, U&gt;::type&gt;;
    }
constexpr auto
operator- (const Point&lt;U&gt;&amp; p) 
    noexcept -&gt; Point&lt;typename std::common_type&lt;T, U&gt;::type&gt;
{ return Point&lt;typename std::common_type&lt;T, U&gt;::type&gt;{ x - p.x, y - p.y }; }

/// ... Point details
</code></pre>
<p><a href="https://www.godbolt.org/z/nqxoE7466">Example</a></p>
<p><a href="https://en.cppreference.com/w/cpp/language/requires#:%7E:text=%3B%20%0A%7D%3B-,Compound%20Requirements,-A%20compound%20requirement">Compound requirements</a></p>
<p><a href="/content/chapter5/tasks/concepts.html">Version 3 of <code>Point</code></a></p>
<h2 id="constrained-variables"><a class="header" href="#constrained-variables">Constrained variables</a></h2>
<p>We can also use concepts to constrain variables declared with the <code>auto</code> specifier. Gives a more robust option for constraining function and method parameters without the need for template declarations or requires clauses.</p>
<pre><code class="language-cxx">#include &lt;concepts&gt;
#include &lt;iostream&gt;

auto println(const std::integral auto&amp; v) -&gt; void
{ std::cout &lt;&lt; v &lt;&lt; std::endl; }

auto main() -&gt; int
{
    println(9);
    // println(46.567);  ///&lt; fails

    return 0;
}
</code></pre>
<p><a href="https://www.godbolt.org/z/vcGW1qPY9">Example</a></p>
<blockquote>
<p>Note: We've applied concepts at the user definition level for classes. These concepts [ideas] can be applied to template functions as well. They are also the basic for defining your own concepts.</p>
</blockquote>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../chapter5/generics.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                            <a rel="next" href="../chapter5/task2.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../chapter5/generics.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                    <a rel="next" href="../chapter5/task2.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>
        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
    </body>
</html>
